**数据库连接池 ： C3P0、DBCP**

**1、数据库连接池技术的优点：**

•资源重用：

     由于数据库连接得以重用，避免了频繁创建，释放连接引起的大量性能开销。在减少系统消耗的基础上，另一方面也增加了系统运行环境的平稳性。

•更快的系统反应速度：

     数据库连接池在初始化过程中，往往已经创建了若干数据库连接置于连接池中备用。此时连接的初始化工作均已完成。对于业务请求处理而言，直接利用现有可用连接，避免了数据库连接初始化和释放过程的时间开销，从而减少了系统的响应时间。

•新的资源分配手段：

     对于多应用共享同一数据库的系统而言，可在应用层通过数据库连接池的配置，实现某一应用最大可用数据库连接数的限制，避免某一应用独占所有的数据库资源。

•统一的连接管理，避免数据库连接泄露：

     在较为完善的数据库连接池实现中，可根据预先的占用超时设定，强制回收被占用连接，从而避免了常规数据库连接操作中可能出现的资源泄露。

 

**1）两种开源的数据库连接池：**

•  JDBC 的数据库连接池使用 javax.sql.DataSource 来表示，DataSource 只是一个接口，

    该接口通常由服务器(Weblogic, WebSphere, Tomcat)提供实现，也有一些开源组织提供实现：

    –DBCP 数据库连接池

    –C3P0 数据库连接池

•  DataSource 通常被称为数据源，它包含连接池和连接池管理两个部分，习惯上也经常把 DataSource 称为连接池

**A:DBCP 数据源 ：**

•  DBCP 是 Apache 软件基金组织下的开源连接池实现，该连接池依赖该组织下的另一个开源系统：Common-pool. 如需使用该连接池实现，应在系统中增加如下两个 jar 文件：

–**Commons-dbcp.jar**：连接池的实现。

–**Commons-pool.jar**：连接池实现的依赖库。

•  **Tomcat 的连接池正是采用该连接池来实现的**。该数据库连接池既可以与应用服务器整合使用，也可由应用程序独立使用。

DBCP 数据源使用范例：

•  数据源和数据库连接不同，数据源无需创建多个，它是产生数据库连接的工厂，因此整个应用只需要一个数据源即可。

•  当数据库访问结束后，程序还是像以前一样关闭数据库连接：conn.close(); 但上面的代码并没有关闭数据库的物理连接，它仅仅把数据库连接释放，归还给了数据库连接池。

          testDBCPWithDataSourceFactory() = = JDBCTest."dbcp.properties"=          testDBCP()  BasicDataSource dataSource = 
            dataSource.setUsername("root""1230""jdbc:mysql:///atguigu""com.mysql.jdbc.Driver"
            dataSource.setInitialSize(5
            dataSource.setMaxActive(5
            dataSource.setMinIdle(2
            dataSource.setMaxWait(1000 * 5
            Connection connection =====">" + =5500

    username==1230==jdbc:mysql:=10=50=5=5000

**B：C3P0 数据源**

          testC3poWithConfigFile() = 
                     ComboPooledDataSource("helloc3p0"=  testC3P0() = "com.mysql.jdbc.Driver" ); 
            cpds.setJdbcUrl( "jdbc:mysql:///atguigu""root""1230"

<?xml version="1.0" encoding="UTF-8"?>

    <c3p0-config>
    
        <named-config name="helloc3p0">
            
            <!-- 指定连接数据源的基本属性 -->
            <property name="user">root</property>
            <property name="password">1230</property>
            <property name="driverClass">com.mysql.jdbc.Driver</property>
            <property name="jdbcUrl">jdbc:mysql:
            
            <!-- 若数据库中连接数不足时, 一次向数据库服务器申请多少个连接 -->
            <property name="acquireIncrement">5</property>
            <!-- 初始化数据库连接池时连接的数量 -->
            <property name="initialPoolSize">5</property>
            <!-- 数据库连接池中的最小的数据库连接数 -->
            <property name="minPoolSize">5</property>
            <!-- 数据库连接池中的最大的数据库连接数 -->
            <property name="maxPoolSize">10</property>
    
            <!-- C3P0 数据库连接池可以维护的 Statement 的个数 -->
            <property name="maxStatements">20</property>
            <!-- 每个连接同时可以使用的 Statement 对象的个数 -->
            <property name="maxStatementsPerConnection">5</property>
        
        </named-config>
            
    </c3p0-config>